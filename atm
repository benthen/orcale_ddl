CREATE TABLE ACCOUNTS
(
    ID NUMBER(5),
    BALANCE NUMBER(10,2),
    NAME VARCHAR2(255) NOT NULL,
    CREATION_DATE DATE,
    CONSTRAINT ID_PK PRIMARY KEY (ID)
);

DESC LOG_DEPOSIT;
INSERT INTO ACCOUNTS VALUES (10002, 2000.00, 'BEN', CURRENT_DATE);
INSERT INTO ACCOUNTS VALUES (10001, 3000.00, 'THEN', CURRENT_DATE);
SELECT * FROM ACCOUNTS;

CREATE TABLE LOG_DEPOSIT
(
    ID NUMBER(5),
    BALANCE_OLD NUMBER(10,2),
    BALANCE_NEW NUMBER(10,2),
    CREATION_DATE DATE,
    CONSTRAINT DEPOSIT_ID_PK PRIMARY KEY (ID)
);

CREATE TABLE LOG_WITHDRAW
(
    ID NUMBER(5),
    BALANCE_OLD NUMBER(10,2),
    BALANCE_NEW NUMBER(10,2),
    CREATION_DATE DATE,
    CONSTRAINT WITHDRAW_ID_PK PRIMARY KEY (ID)
);

CREATE TABLE LOG_TRANSFER
(
    TRANSFER_ID NUMBER(5),
    SOURCE_ID NUMBER(5) NOT NULL,
    TARGET_ID NUMBER(5) NOT NULL,
    AMOUNT NUMBER(10,2),
    CREATION_DATE DATE
);

CREATE OR REPLACE PROCEDURE DEPOSIT_MONEY
(ACC_ID IN NUMBER, AMOUNT NUMBER) AS 
BEGIN
    UPDATE ACCOUNTS SET BALANCE = BALANCE + AMOUNT WHERE ID = ACC_ID;
END;

CREATE OR REPLACE PROCEDURE WINTHDRAW_MONEY
(ACC_ID IN NUMBER, AMOUNT NUMBER) AS 
BEGIN
    UPDATE ACCOUNTS SET BALANCE = BALANCE - AMOUNT WHERE ID = ACC_ID;
END;

CREATE OR REPLACE PROCEDURE TRANSFER_MONEY
(ACC1 IN NUMBER, ACC2 IN NUMBER, AMOUNT NUMBER) AS
BEGIN
    UPDATE ACCOUNTS SET BALANCE = BALANCE + AMOUNT WHERE ID = ACC2;
    UPDATE ACCOUNTS SET BALANCE = BALANCE - AMOUNT WHERE ID = ACC1;
END;

CREATE OR REPLACE TRIGGER MONEY_LOG
BEFORE UPDATE OR INSERT OR DELETE ON ACCOUNTS
FOR EACH ROW
WHEN(NEW.ID>0)
BEGIN
    INSERT INTO LOG_DEPOSIT VALUES (:NEW.ID, :OLD.BALANCE, :NEW.BALANCE, :NEW.CREATION_DATE);
END;

SELECT * FROM ACCOUNT;

SELECT * FROM LOG_DEPOSIT;

CREATE OR REPLACE TRIGGER DEPOSIT_LOG
BEFORE UPDATE ON ACCOUNT
FOR EACH ROW
BEGIN
    INSERT INTO LOG_DEPOSIT VALUES (:OLD.ID, :OLD.BALANCE, :NEW.BALANCE, CURRENT_DATE);
END;

CREATE OR REPLACE PROCEDURE TRANSFER_MONEY
(ACC_ID1 NUMBER, ACC_ID2 NUMBER, AMOUNT NUMBER)
AS
BEGIN
    UPDATE ACCOUNT SET BALANCE = BALANCE + AMOUNT WHERE ID = ACC_ID2;
    UPDATE ACCOUNT SET BALANCE = BALANCE - AMOUNT WHERE ID = ACC_ID1;
END;

CREATE OR REPLACE PROCEDURE WITHDRAW_MONEY
(ACC_ID NUMBER, AMOUNT NUMBER)
AS
BEGIN
    UPDATE ACCOUNT SET BALANCE = BALANCE - AMOUNT WHERE ID = ACC_ID;
END;

CREATE OR REPLACE PROCEDURE DEPOSIT_MONEY
(ACC_ID NUMBER, AMOUNT NUMBER)
AS
BEGIN
    UPDATE ACCOUNT SET BALANCE = BALANCE + AMOUNT WHERE ID = ACC_ID;
END;



